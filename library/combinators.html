
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://genjax.gen.dev/library/combinators.html">
      
      
        <link rel="prev" href="generative_functions.html">
      
      
        <link rel="next" href="inference.html">
      
      
      <link rel="icon" href="../assets/img/small_logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Combinators - GenJAX</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CBerkeley+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Berkeley Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../assets/_markdown_exec_ansi.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#combinators-structured-patterns-of-composition" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="GenJAX" class="md-header__button md-logo" aria-label="GenJAX" data-md-component="logo">
      
  <img src="../assets/img/small_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GenJAX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Combinators
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/genjax-dev/genjax-chi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    genjax-dev/genjax-chi
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../cookbook/active/jax_basics.html" class="md-tabs__link">
          
  
  
    
  
  Cookbook

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="core.html" class="md-tabs__link">
          
  
  
    
  
  Library reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developing.html" class="md-tabs__link">
          
  
  
    
  
  For developers

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="GenJAX" class="md-nav__button md-logo" aria-label="GenJAX" data-md-component="logo">
      
  <img src="../assets/img/small_logo.png" alt="logo">

    </a>
    GenJAX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/genjax-dev/genjax-chi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    genjax-dev/genjax-chi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../cookbook/active/jax_basics.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Cookbook
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Library reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Library reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="core.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generative_functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generative functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Combinators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="combinators.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Combinators
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vmap-like-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      vmap-like Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.vmap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;vmap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.vmap(in_axes)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;in_axes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.repeat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;repeat
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" repeat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.repeat(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scan-like-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      scan-like Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.scan" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.scan(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.accumulate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;accumulate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;reduce
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.iterate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;iterate
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" iterate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.iterate(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.iterate_final" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;iterate_final
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" iterate_final">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.iterate_final(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.masked_iterate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_iterate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.masked_iterate_final" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_iterate_final
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-flow-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      Control Flow Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.or_else" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;or_else
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" or_else">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.or_else(else_gen_fn)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;else_gen_fn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.switch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;switch
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" switch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.switch(gen_fns)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;gen_fns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argument-and-return-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Argument and Return Transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.dimap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dimap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" dimap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.dimap(pre)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;pre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#genjax.dimap(post)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;post
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.map" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.map(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.contramap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;contramap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" contramap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.contramap(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rest" class="md-nav__link">
    <span class="md-ellipsis">
      The Rest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.mask(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.mix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mix
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" mix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.mix(*gen_fns)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;*gen_fns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../developing.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    For developers
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vmap-like-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      vmap-like Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.vmap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;vmap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.vmap(in_axes)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;in_axes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.repeat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;repeat
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" repeat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.repeat(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scan-like-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      scan-like Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.scan" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.scan(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.accumulate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;accumulate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;reduce
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.iterate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;iterate
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" iterate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.iterate(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.iterate_final" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;iterate_final
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" iterate_final">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.iterate_final(n)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.masked_iterate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_iterate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.masked_iterate_final" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;masked_iterate_final
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-flow-combinators" class="md-nav__link">
    <span class="md-ellipsis">
      Control Flow Combinators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.or_else" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;or_else
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" or_else">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.or_else(else_gen_fn)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;else_gen_fn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.switch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;switch
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" switch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.switch(gen_fns)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;gen_fns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argument-and-return-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Argument and Return Transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.dimap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;dimap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" dimap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.dimap(pre)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;pre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#genjax.dimap(post)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;post
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.map" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.map(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.contramap" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;contramap
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" contramap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.contramap(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rest" class="md-nav__link">
    <span class="md-ellipsis">
      The Rest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.mask(f)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;f
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genjax.mix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mix
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" mix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genjax.mix(*gen_fns)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;*gen_fns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/genjax-dev/genjax-chi/edit/main/docs/library/combinators.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/genjax-dev/genjax-chi/raw/main/docs/library/combinators.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="combinators-structured-patterns-of-composition">Combinators: structured patterns of composition<a class="headerlink" href="#combinators-structured-patterns-of-composition" title="Permanent link">&para;</a></h1>
<p>While the programmatic <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.StaticGenerativeFunction&lt;/span&gt;" href="generative_functions.html#genjax.StaticGenerativeFunction"><code>genjax.StaticGenerativeFunction</code></a> language is powerful, its restrictions can be limiting. Combinators are a way to express common patterns of composition in a more concise way, and to gain access to effects which are common in JAX (like <code>jax.vmap</code>) for generative computations.</p>
<p>Each of the combinators below is implemented as a method on <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and as a standalone decorator.</p>
<p>You should strongly prefer the method form. Here's an example of the <code>vmap</code> combinator created by the <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;vmap&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction.vmap"><code>genjax.GenerativeFunction.vmap</code></a> method:</p>
<p>Here is the <code>vmap</code> combinator used as a method. <code>square_many</code> below accepts an array and returns an array:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">square_many</span> <span class="o">=</span> <span class="n">square</span><span class="o">.</span><span class="n">vmap</span><span class="p">()</span>
</span></code></pre></div>
<div class="result">

</div>
<p>Here is <code>square_many</code> defined with <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.vmap&lt;/span&gt;" href="#genjax.vmap"><code>genjax.vmap</code></a>, the decorator version of the <code>vmap</code> method:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">vmap</span><span class="p">()</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">square_many_decorator</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span></code></pre></div>
<div class="result">

</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We do <em>not</em> recommend this style, since the original building block generative function won't be available by itself. Please prefer using the combinator methods, or the transformation style shown below.</p>
</div>
<p>If you insist on using the decorator form, you can preserve the original function like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># Use the decorator as a transformation:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">square_many_better</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">vmap</span><span class="p">()(</span><span class="n">square</span><span class="p">)</span>
</span></code></pre></div>
<div class="result">

</div>
<h2 id="vmap-like-combinators"><code>vmap</code>-like Combinators<a class="headerlink" href="#vmap-like-combinators" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="genjax.vmap" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.vmap</span>


<a href="#genjax.vmap" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">vmap</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;in_axes&lt;/code&gt; (&lt;code&gt;genjax.vmap(in_axes)&lt;/code&gt;)" href="#genjax.vmap(in_axes)">in_axes</a></span><span class="p">:</span> <span class="n"><span title="genjax._src.core.typing.InAxes">InAxes</span></span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.core.generative.R">R</span></span><span class="p">]],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.vmap.Vmap">Vmap</span></span><span class="p">[</span><span class="n"><span title="genjax._src.core.generative.R">R</span></span><span class="p">]]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>GenerativeFunction</code></a> and returns a new <code>GenerativeFunction</code> that performs a vectorized map over the argument specified by <code>in_axes</code>. Traced values are nested under an index, and the retval is vectorized.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.vmap(in_axes)" class="doc doc-heading doc-heading-parameter">                  <code>in_axes</code>
<a href="#genjax.vmap(in_axes)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="genjax._src.core.typing.InAxes">InAxes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Selector specifying which input arguments (or index into them) should be vectorized. <code>in_axes</code> must match (or prefix) the <code>Pytree</code> type of the argument tuple for the underlying <code>gen_fn</code>. Defaults to 0, i.e., the first argument. See <a href="https://jax.readthedocs.io/en/latest/pytrees.html#applying-optional-parameters-to-pytrees">this link</a> for more detail.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.core.generative.R">R</span>]], <span title="genjax._src.generative_functions.combinators.vmap.Vmap">Vmap</span>[<span title="genjax._src.core.generative.R">R</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A decorator that converts a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> into a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> that accepts an argument of one-higher dimension at the position specified by <code>in_axes</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">vmapped_model</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;v&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;q&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">arr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># `vmapped_model` accepts an array of numbers:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">vmapped_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">arr</span><span class="p">,))</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_130d7ed9dbb54432b4791af0d6c69e07" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_130d7ed9dbb54432b4791af0d6c69e07")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_130d7ed9dbb54432b4791af0d6c69e07")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/vmap.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="k">def</span><span class="w"> </span><span class="nf">vmap</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">:</span> <span class="n">InAxes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]],</span> <span class="n">Vmap</span><span class="p">[</span><span class="n">R</span><span class="p">]]:</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    Returns a decorator that wraps a [`GenerativeFunction`][genjax.GenerativeFunction] and returns a new `GenerativeFunction` that performs a vectorized map over the argument specified by `in_axes`. Traced values are nested under an index, and the retval is vectorized.</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    Args:</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        in_axes: Selector specifying which input arguments (or index into them) should be vectorized. `in_axes` must match (or prefix) the `Pytree` type of the argument tuple for the underlying `gen_fn`. Defaults to 0, i.e., the first argument. See [this link](https://jax.readthedocs.io/en/latest/pytrees.html#applying-optional-parameters-to-pytrees) for more detail.</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        A decorator that converts a [`genjax.GenerativeFunction`][] into a new [`genjax.GenerativeFunction`][] that accepts an argument of one-higher dimension at the position specified by `in_axes`.</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;vmap&quot;</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        import jax, genjax</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        import jax.numpy as jnp</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        @genjax.vmap(in_axes=0)</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        def vmapped_model(x):</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            v = genjax.normal(x, 1.0) @ &quot;v&quot;</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            return genjax.normal(v, 0.01) @ &quot;q&quot;</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        arr = jnp.ones(100)</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        # `vmapped_model` accepts an array of numbers:</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">        tr = jax.jit(vmapped_model.simulate)(key, (arr,))</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        ```</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">gen_fn</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Vmap</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">return</span> <span class="n">Vmap</span><span class="p">(</span><span class="n">gen_fn</span><span class="p">,</span> <span class="n">in_axes</span><span class="p">)</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.repeat" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.repeat</span>


<a href="#genjax.repeat" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">repeat</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;n&lt;/code&gt; (&lt;code&gt;genjax.repeat(n)&lt;/code&gt;)" href="#genjax.repeat(n)">n</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.repeat.R">R</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.repeat.R">R</span></span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> <code>gen_fn</code> of type <code>a -&gt; b</code> and returns a new <code>GenerativeFunction</code> of type <code>a -&gt; [b]</code> that samples from <code>gen_fn</code>n<code>times, returning a vector of</code>n` results.</p>
<p>The values traced by each call <code>gen_fn</code> will be nested under an integer index that matches the loop iteration index that generated it.</p>
<p>This combinator is useful for creating multiple samples from the same generative model in a batched manner.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.repeat(n)" class="doc doc-heading doc-heading-parameter">                  <code>n</code>
<a href="#genjax.repeat(n)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of times to sample from the generative function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.repeat.R">R</span>]], <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.repeat.R">R</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> that samples from the original function <code>n</code> times.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span><span class="o">,</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">normal_draws</span><span class="p">(</span><span class="n">mean</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;x&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c1"># Generate 10 draws from a normal distribution with mean 2.0</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">normal_draws</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,))</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_5e34cbd358d34a9ea74dca6fea27529c" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_5e34cbd358d34a9ea74dca6fea27529c")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_5e34cbd358d34a9ea74dca6fea27529c")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/repeat.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span><span class="w"> </span><span class="nf">repeat</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]]:</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Returns a decorator that wraps a [`genjax.GenerativeFunction`][] `gen_fn` of type `a -&gt; b` and returns a new `GenerativeFunction` of type `a -&gt; [b]` that samples from `gen_fn `n` times, returning a vector of `n` results.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    The values traced by each call `gen_fn` will be nested under an integer index that matches the loop iteration index that generated it.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    This combinator is useful for creating multiple samples from the same generative model in a batched manner.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Args:</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        n: The number of times to sample from the generative function.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        A new [`genjax.GenerativeFunction`][] that samples from the original function `n` times.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;repeat&quot;</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        import genjax, jax</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        @genjax.repeat(n=10)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        def normal_draws(mean):</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            return genjax.normal(mean, 1.0) @ &quot;x&quot;</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        # Generate 10 draws from a normal distribution with mean 2.0</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        tr = jax.jit(normal_draws.simulate)(key, (2.0,))</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        ```</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">gen_fn</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">return</span> <span class="n">RepeatCombinator</span><span class="p">(</span><span class="n">gen_fn</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="scan-like-combinators"><code>scan</code>-like Combinators<a class="headerlink" href="#scan-like-combinators" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="genjax.scan" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.scan</span>


<a href="#genjax.scan" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">scan</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;n&lt;/code&gt; (&lt;code&gt;genjax.scan(n)&lt;/code&gt;)" href="#genjax.scan(n)">n</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]]],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, a) -&gt; (c, b)</code>and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, [a]) -&gt; (c, [b])</code> where.</p>
<ul>
<li><code>c</code> is a loop-carried value, which must hold a fixed shape and dtype across all iterations</li>
<li><code>a</code> may be a primitive, an array type or a pytree (container) type with array leaves</li>
<li><code>b</code> may be a primitive, an array type or a pytree (container) type with array leaves.</li>
</ul>
<p>The values traced by each call to the original generative function will be nested under an integer index that matches the loop iteration index that generated it.</p>
<p>For any array type specifier <code>t</code>, <code>[t]</code> represents the type with an additional leading axis, and if <code>t</code> is a pytree (container) type with array leaves then <code>[t]</code> represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</p>
<p>When the type of <code>xs</code> in the snippet below (denoted <code>[a]</code> above) is an array type or None, and the type of <code>ys</code> in the snippet below (denoted <code>[b]</code> above) is an array type, the semantics of the returned <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> are given roughly by this Python implementation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="k">if</span> <span class="n">xs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">carry</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="n">carry</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
</span></code></pre></div>
<p>Unlike that Python version, both <code>xs</code> and <code>ys</code> may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays. <code>None</code> is actually a special case of this, as it represents an empty pytree.</p>
<p>The loop-carried value <code>c</code> must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type <code>c</code> in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.scan(n)" class="doc doc-heading doc-heading-parameter">                  <code>n</code>
<a href="#genjax.scan(n)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional integer specifying the number of loop iterations, which (if supplied) must agree with the sizes of leading axes of the arrays in the returned function's second argument. If supplied then the returned generative function can take <code>None</code> as its second argument.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="tuple">tuple</span>[<span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span>, <span title="genjax._src.generative_functions.combinators.scan.Y">Y</span>]]], <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="tuple">tuple</span>[<span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span>, <span title="genjax._src.generative_functions.combinators.scan.Y">Y</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> that takes a loop-carried value and a new input, and returns a new loop-carried value along with either <code>None</code> or an output to be collected into the second return value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Scan for 1000 iterations with no array input:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">random_walk</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;x&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">random_walk</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_8a07ac20fb814172a927e742018df279" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_8a07ac20fb814172a927e742018df279")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_8a07ac20fb814172a927e742018df279")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>
<p>Scan across an input array:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_and_square_all</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">new_sum</span><span class="p">,</span> <span class="nb">sum</span> <span class="o">*</span> <span class="nb">sum</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">xs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add_and_square_all</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># The retval has the final carry and an array of all `sum*sum` returned.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_05e816f246f945c68590080f20162a67" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_05e816f246f945c68590080f20162a67")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_05e816f246f945c68590080f20162a67")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="p">[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Carry</span><span class="p">,</span> <span class="n">Y</span><span class="p">]]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Carry</span><span class="p">,</span> <span class="n">Y</span><span class="p">]]</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="p">]:</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that wraps a [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    `(c, a) -&gt; (c, b)`and returns a new [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">    `(c, [a]) -&gt; (c, [b])` where.</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    - `c` is a loop-carried value, which must hold a fixed shape and dtype across all iterations</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    - `a` may be a primitive, an array type or a pytree (container) type with array leaves</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    - `b` may be a primitive, an array type or a pytree (container) type with array leaves.</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a>
</span><span id="__span-0-685"><a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    The values traced by each call to the original generative function will be nested under an integer index that matches the loop iteration index that generated it.</span>
</span><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    For any array type specifier `t`, `[t]` represents the type with an additional leading axis, and if `t` is a pytree (container) type with array leaves then `[t]` represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    When the type of `xs` in the snippet below (denoted `[a]` above) is an array type or None, and the type of `ys` in the snippet below (denoted `[b]` above) is an array type, the semantics of the returned [`genjax.GenerativeFunction`][] are given roughly by this Python implementation:</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    ```python</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    def scan(f, init, xs, length=None):</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        if xs is None:</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">            xs = [None] * length</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        carry = init</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">        ys = []</span>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">        for x in xs:</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">            carry, y = f(carry, x)</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">            ys.append(y)</span>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">        return carry, np.stack(ys)</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    ```</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">    Unlike that Python version, both `xs` and `ys` may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays. `None` is actually a special case of this, as it represents an empty pytree.</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">    The loop-carried value `c` must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type `c` in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">    Args:</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">        n: optional integer specifying the number of loop iterations, which (if supplied) must agree with the sizes of leading axes of the arrays in the returned function&#39;s second argument. If supplied then the returned generative function can take `None` as its second argument.</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">        A new [`genjax.GenerativeFunction`][] that takes a loop-carried value and a new input, and returns a new loop-carried value along with either `None` or an output to be collected into the second return value.</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">        Scan for 1000 iterations with no array input:</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">        import jax</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        @genjax.scan(n=1000)</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        def random_walk(prev, _):</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">            x = genjax.normal(prev, 1.0) @ &quot;x&quot;</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">            return x, None</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725"></a>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726"></a>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        init = 0.5</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729"></a>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        tr = jax.jit(random_walk.simulate)(key, (init, None))</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        ```</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733"></a>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        Scan across an input array:</span>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        import jax.numpy as jnp</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737"></a>
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738"></a>
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        @genjax.scan()</span>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        def add_and_square_all(sum, x):</span>
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">            new_sum = sum + x</span>
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">            return new_sum, sum * sum</span>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744"></a>
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745"></a>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">        init = 0.0</span>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">        xs = jnp.ones(10)</span>
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748"></a>
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">        tr = jax.jit(add_and_square_all.simulate)(key, (init, xs))</span>
</span><span id="__span-0-750"><a id="__codelineno-0-750" name="__codelineno-0-750"></a>
</span><span id="__span-0-751"><a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        # The retval has the final carry and an array of all `sum*sum` returned.</span>
</span><span id="__span-0-752"><a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-753"><a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        ```</span>
</span><span id="__span-0-754"><a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-755"><a id="__codelineno-0-755" name="__codelineno-0-755"></a>
</span><span id="__span-0-756"><a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Carry</span><span class="p">,</span> <span class="n">Y</span><span class="p">]]):</span>
</span><span id="__span-0-757"><a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="k">return</span> <span class="n">Scan</span><span class="p">[</span><span class="n">Carry</span><span class="p">,</span> <span class="n">Y</span><span class="p">](</span><span class="n">f</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-0-758"><a id="__codelineno-0-758" name="__codelineno-0-758"></a>
</span><span id="__span-0-759"><a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.accumulate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.accumulate</span>


<a href="#genjax.accumulate" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">accumulate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">]],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, a) -&gt; c</code> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, [a]) -&gt; [c]</code> where.</p>
<ul>
<li><code>c</code> is a loop-carried value, which must hold a fixed shape and dtype across all iterations</li>
<li><code>[c]</code> is an array of all loop-carried values seen during iteration (including the first)</li>
<li><code>a</code> may be a primitive, an array type or a pytree (container) type with array leaves</li>
</ul>
<p>All traced values are nested under an index.</p>
<p>For any array type specifier <code>t</code>, <code>[t]</code> represents the type with an additional leading axis, and if <code>t</code> is a pytree (container) type with array leaves then <code>[t]</code> represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</p>
<p>The semantics of the returned <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> are given roughly by this Python implementation (note the similarity to <a href="https://docs.python.org/3/library/itertools.html#itertools.accumulate"><code>itertools.accumulate</code></a>):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">accumulate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">carry</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">carries</span> <span class="o">=</span> <span class="p">[</span><span class="n">init</span><span class="p">]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">carry</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="n">carries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">carries</span>
</span></code></pre></div>
<p>Unlike that Python version, both <code>xs</code> and <code>carries</code> may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays.</p>
<p>The loop-carried value <code>c</code> must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type <code>c</code> in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</p>


<p><span class="doc-section-title">Examples:</span></p>
    <p>accumulate a running total:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">accumulate</span><span class="p">()</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">new_sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">return</span> <span class="n">new_sum</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">xs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_4bb5cdd7387e4505bfe339ec5f43bfd9" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_4bb5cdd7387e4505bfe339ec5f43bfd9")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_4bb5cdd7387e4505bfe339ec5f43bfd9")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-791"><a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="k">def</span><span class="w"> </span><span class="nf">accumulate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]]:</span>
</span><span id="__span-0-792"><a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that wraps a [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-793"><a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    `(c, a) -&gt; c` and returns a new [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-794"><a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">    `(c, [a]) -&gt; [c]` where.</span>
</span><span id="__span-0-795"><a id="__codelineno-0-795" name="__codelineno-0-795"></a>
</span><span id="__span-0-796"><a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    - `c` is a loop-carried value, which must hold a fixed shape and dtype across all iterations</span>
</span><span id="__span-0-797"><a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">    - `[c]` is an array of all loop-carried values seen during iteration (including the first)</span>
</span><span id="__span-0-798"><a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">    - `a` may be a primitive, an array type or a pytree (container) type with array leaves</span>
</span><span id="__span-0-799"><a id="__codelineno-0-799" name="__codelineno-0-799"></a>
</span><span id="__span-0-800"><a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">    All traced values are nested under an index.</span>
</span><span id="__span-0-801"><a id="__codelineno-0-801" name="__codelineno-0-801"></a>
</span><span id="__span-0-802"><a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">    For any array type specifier `t`, `[t]` represents the type with an additional leading axis, and if `t` is a pytree (container) type with array leaves then `[t]` represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</span>
</span><span id="__span-0-803"><a id="__codelineno-0-803" name="__codelineno-0-803"></a>
</span><span id="__span-0-804"><a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    The semantics of the returned [`genjax.GenerativeFunction`][] are given roughly by this Python implementation (note the similarity to [`itertools.accumulate`](https://docs.python.org/3/library/itertools.html#itertools.accumulate)):</span>
</span><span id="__span-0-805"><a id="__codelineno-0-805" name="__codelineno-0-805"></a>
</span><span id="__span-0-806"><a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    ```python</span>
</span><span id="__span-0-807"><a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">    def accumulate(f, init, xs):</span>
</span><span id="__span-0-808"><a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        carry = init</span>
</span><span id="__span-0-809"><a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        carries = [init]</span>
</span><span id="__span-0-810"><a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        for x in xs:</span>
</span><span id="__span-0-811"><a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">            carry = f(carry, x)</span>
</span><span id="__span-0-812"><a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">            carries.append(carry)</span>
</span><span id="__span-0-813"><a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">        return carries</span>
</span><span id="__span-0-814"><a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    ```</span>
</span><span id="__span-0-815"><a id="__codelineno-0-815" name="__codelineno-0-815"></a>
</span><span id="__span-0-816"><a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">    Unlike that Python version, both `xs` and `carries` may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays.</span>
</span><span id="__span-0-817"><a id="__codelineno-0-817" name="__codelineno-0-817"></a>
</span><span id="__span-0-818"><a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">    The loop-carried value `c` must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type `c` in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</span>
</span><span id="__span-0-819"><a id="__codelineno-0-819" name="__codelineno-0-819"></a>
</span><span id="__span-0-820"><a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-821"><a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">        accumulate a running total:</span>
</span><span id="__span-0-822"><a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-823"><a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">        import jax</span>
</span><span id="__span-0-824"><a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-825"><a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        import jax.numpy as jnp</span>
</span><span id="__span-0-826"><a id="__codelineno-0-826" name="__codelineno-0-826"></a>
</span><span id="__span-0-827"><a id="__codelineno-0-827" name="__codelineno-0-827"></a>
</span><span id="__span-0-828"><a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        @genjax.accumulate()</span>
</span><span id="__span-0-829"><a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-830"><a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">        def add(sum, x):</span>
</span><span id="__span-0-831"><a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">            new_sum = sum + x</span>
</span><span id="__span-0-832"><a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">            return new_sum</span>
</span><span id="__span-0-833"><a id="__codelineno-0-833" name="__codelineno-0-833"></a>
</span><span id="__span-0-834"><a id="__codelineno-0-834" name="__codelineno-0-834"></a>
</span><span id="__span-0-835"><a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">        init = 0.0</span>
</span><span id="__span-0-836"><a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-837"><a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">        xs = jnp.ones(10)</span>
</span><span id="__span-0-838"><a id="__codelineno-0-838" name="__codelineno-0-838"></a>
</span><span id="__span-0-839"><a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">        tr = jax.jit(add.simulate)(key, (init, xs))</span>
</span><span id="__span-0-840"><a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-841"><a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">        ```</span>
</span><span id="__span-0-842"><a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-843"><a id="__codelineno-0-843" name="__codelineno-0-843"></a>
</span><span id="__span-0-844"><a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]:</span>
</span><span id="__span-0-845"><a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-846"><a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="n">f</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ret</span><span class="p">:</span> <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ret</span><span class="p">))</span>
</span><span id="__span-0-847"><a id="__codelineno-0-847" name="__codelineno-0-847"></a>            <span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</span><span id="__span-0-848"><a id="__codelineno-0-848" name="__codelineno-0-848"></a>            <span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">prepend_initial_acc</span><span class="p">)</span>
</span><span id="__span-0-849"><a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="p">)</span>
</span><span id="__span-0-850"><a id="__codelineno-0-850" name="__codelineno-0-850"></a>
</span><span id="__span-0-851"><a id="__codelineno-0-851" name="__codelineno-0-851"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.reduce" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.reduce</span>


<a href="#genjax.reduce" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reduce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">]],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Carry">Carry</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, a) -&gt; c</code> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>(c, [a]) -&gt; c</code> where.</p>
<ul>
<li><code>c</code> is a loop-carried value, which must hold a fixed shape and dtype across all iterations</li>
<li><code>a</code> may be a primitive, an array type or a pytree (container) type with array leaves</li>
</ul>
<p>All traced values are nested under an index.</p>
<p>For any array type specifier <code>t</code>, <code>[t]</code> represents the type with an additional leading axis, and if <code>t</code> is a pytree (container) type with array leaves then <code>[t]</code> represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</p>
<p>The semantics of the returned <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> are given roughly by this Python implementation (note the similarity to <a href="https://docs.python.org/3/library/itertools.html#functools.reduce"><code>functools.reduce</code></a>):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">carry</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="n">carry</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">carry</span>
</span></code></pre></div>
<p>Unlike that Python version, both <code>xs</code> and <code>carry</code> may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays.</p>
<p>The loop-carried value <code>c</code> must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type <code>c</code> in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</p>


<p><span class="doc-section-title">Examples:</span></p>
    <p>sum an array of numbers:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">reduce</span><span class="p">()</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">new_sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">x</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">return</span> <span class="n">new_sum</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">xs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_eae955bbb174417eb060adb6cdfe3327" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_eae955bbb174417eb060adb6cdfe3327")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_eae955bbb174417eb060adb6cdfe3327")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-854"><a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]]:</span>
</span><span id="__span-0-855"><a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that wraps a [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-856"><a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    `(c, a) -&gt; c` and returns a new [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-857"><a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">    `(c, [a]) -&gt; c` where.</span>
</span><span id="__span-0-858"><a id="__codelineno-0-858" name="__codelineno-0-858"></a>
</span><span id="__span-0-859"><a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">    - `c` is a loop-carried value, which must hold a fixed shape and dtype across all iterations</span>
</span><span id="__span-0-860"><a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">    - `a` may be a primitive, an array type or a pytree (container) type with array leaves</span>
</span><span id="__span-0-861"><a id="__codelineno-0-861" name="__codelineno-0-861"></a>
</span><span id="__span-0-862"><a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">    All traced values are nested under an index.</span>
</span><span id="__span-0-863"><a id="__codelineno-0-863" name="__codelineno-0-863"></a>
</span><span id="__span-0-864"><a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    For any array type specifier `t`, `[t]` represents the type with an additional leading axis, and if `t` is a pytree (container) type with array leaves then `[t]` represents the type with the same pytree structure and corresponding leaves each with an additional leading axis.</span>
</span><span id="__span-0-865"><a id="__codelineno-0-865" name="__codelineno-0-865"></a>
</span><span id="__span-0-866"><a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">    The semantics of the returned [`genjax.GenerativeFunction`][] are given roughly by this Python implementation (note the similarity to [`functools.reduce`](https://docs.python.org/3/library/itertools.html#functools.reduce)):</span>
</span><span id="__span-0-867"><a id="__codelineno-0-867" name="__codelineno-0-867"></a>
</span><span id="__span-0-868"><a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">    ```python</span>
</span><span id="__span-0-869"><a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">    def reduce(f, init, xs):</span>
</span><span id="__span-0-870"><a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">        carry = init</span>
</span><span id="__span-0-871"><a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">        for x in xs:</span>
</span><span id="__span-0-872"><a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">            carry = f(carry, x)</span>
</span><span id="__span-0-873"><a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="sd">        return carry</span>
</span><span id="__span-0-874"><a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">    ```</span>
</span><span id="__span-0-875"><a id="__codelineno-0-875" name="__codelineno-0-875"></a>
</span><span id="__span-0-876"><a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">    Unlike that Python version, both `xs` and `carry` may be arbitrary pytree values, and so multiple arrays can be scanned over at once and produce multiple output arrays.</span>
</span><span id="__span-0-877"><a id="__codelineno-0-877" name="__codelineno-0-877"></a>
</span><span id="__span-0-878"><a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">    The loop-carried value `c` must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type `c` in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</span>
</span><span id="__span-0-879"><a id="__codelineno-0-879" name="__codelineno-0-879"></a>
</span><span id="__span-0-880"><a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-881"><a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">        sum an array of numbers:</span>
</span><span id="__span-0-882"><a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-883"><a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">        import jax</span>
</span><span id="__span-0-884"><a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-885"><a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">        import jax.numpy as jnp</span>
</span><span id="__span-0-886"><a id="__codelineno-0-886" name="__codelineno-0-886"></a>
</span><span id="__span-0-887"><a id="__codelineno-0-887" name="__codelineno-0-887"></a>
</span><span id="__span-0-888"><a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">        @genjax.reduce()</span>
</span><span id="__span-0-889"><a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-890"><a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">        def add(sum, x):</span>
</span><span id="__span-0-891"><a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">            new_sum = sum + x</span>
</span><span id="__span-0-892"><a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">            return new_sum</span>
</span><span id="__span-0-893"><a id="__codelineno-0-893" name="__codelineno-0-893"></a>
</span><span id="__span-0-894"><a id="__codelineno-0-894" name="__codelineno-0-894"></a>
</span><span id="__span-0-895"><a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        init = 0.0</span>
</span><span id="__span-0-896"><a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-897"><a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        xs = jnp.ones(10)</span>
</span><span id="__span-0-898"><a id="__codelineno-0-898" name="__codelineno-0-898"></a>
</span><span id="__span-0-899"><a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        tr = jax.jit(add.simulate)(key, (init, xs))</span>
</span><span id="__span-0-900"><a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-901"><a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        ```</span>
</span><span id="__span-0-902"><a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-903"><a id="__codelineno-0-903" name="__codelineno-0-903"></a>
</span><span id="__span-0-904"><a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Carry</span><span class="p">]:</span>
</span><span id="__span-0-905"><a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">pre</span><span class="p">(</span><span class="n">ret</span><span class="p">:</span> <span class="n">Carry</span><span class="p">):</span>
</span><span id="__span-0-906"><a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-907"><a id="__codelineno-0-907" name="__codelineno-0-907"></a>
</span><span id="__span-0-908"><a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">ret</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Carry</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
</span><span id="__span-0-909"><a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-910"><a id="__codelineno-0-910" name="__codelineno-0-910"></a>
</span><span id="__span-0-911"><a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pre</span><span class="p">)</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span id="__span-0-912"><a id="__codelineno-0-912" name="__codelineno-0-912"></a>
</span><span id="__span-0-913"><a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.iterate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.iterate</span>


<a href="#genjax.iterate" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">iterate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;n&lt;/code&gt; (&lt;code&gt;genjax.iterate(n)&lt;/code&gt;)" href="#genjax.iterate(n)">n</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>a -&gt; a</code> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type <code>a -&gt;
[a]</code> where.</p>
<ul>
<li><code>a</code> is a loop-carried value, which must hold a fixed shape and dtype across all iterations</li>
<li><code>[a]</code> is an array of all <code>a</code>, <code>f(a)</code>, <code>f(f(a))</code> etc. values seen during iteration.</li>
</ul>
<p>All traced values are nested under an index.</p>
<p>The semantics of the returned <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> are given roughly by this Python implementation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">init</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="nb">input</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">seen</span> <span class="o">=</span> <span class="p">[</span><span class="n">init</span><span class="p">]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="nb">input</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">seen</span>
</span></code></pre></div>
<p><code>init</code> may be an arbitrary pytree value, and so multiple arrays can be iterated over at once and produce multiple output arrays.</p>
<p>The iterated value <code>a</code> must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type <code>a</code> in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.iterate(n)" class="doc doc-heading doc-heading-parameter">                  <code>n</code>
<a href="#genjax.iterate(n)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of iterations to run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>iterative addition, returning all intermediate sums:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">inc</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,))</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_7de1b6e759384d87b8474869517d7994" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_7de1b6e759384d87b8474869517d7994")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_7de1b6e759384d87b8474869517d7994")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-916"><a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="k">def</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]]:</span>
</span><span id="__span-0-917"><a id="__codelineno-0-917" name="__codelineno-0-917"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that wraps a [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-918"><a id="__codelineno-0-918" name="__codelineno-0-918"></a><span class="sd">    `a -&gt; a` and returns a new [`genjax.GenerativeFunction`][] of type `a -&gt;</span>
</span><span id="__span-0-919"><a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">    [a]` where.</span>
</span><span id="__span-0-920"><a id="__codelineno-0-920" name="__codelineno-0-920"></a>
</span><span id="__span-0-921"><a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">    - `a` is a loop-carried value, which must hold a fixed shape and dtype across all iterations</span>
</span><span id="__span-0-922"><a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">    - `[a]` is an array of all `a`, `f(a)`, `f(f(a))` etc. values seen during iteration.</span>
</span><span id="__span-0-923"><a id="__codelineno-0-923" name="__codelineno-0-923"></a>
</span><span id="__span-0-924"><a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="sd">    All traced values are nested under an index.</span>
</span><span id="__span-0-925"><a id="__codelineno-0-925" name="__codelineno-0-925"></a>
</span><span id="__span-0-926"><a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">    The semantics of the returned [`genjax.GenerativeFunction`][] are given roughly by this Python implementation:</span>
</span><span id="__span-0-927"><a id="__codelineno-0-927" name="__codelineno-0-927"></a>
</span><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">    ```python</span>
</span><span id="__span-0-929"><a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    def iterate(f, n, init):</span>
</span><span id="__span-0-930"><a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">        input = init</span>
</span><span id="__span-0-931"><a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">        seen = [init]</span>
</span><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        for _ in range(n):</span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">            input = f(input)</span>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">            seen.append(input)</span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">        return seen</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">    ```</span>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    `init` may be an arbitrary pytree value, and so multiple arrays can be iterated over at once and produce multiple output arrays.</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    The iterated value `a` must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type `a` in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</span>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a>
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    Args:</span>
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        n: the number of iterations to run.</span>
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a>
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        iterative addition, returning all intermediate sums:</span>
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">        import jax</span>
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a>
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">        @genjax.iterate(n=100)</span>
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">        def inc(x):</span>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">            return x + 1</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a>
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a>
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        init = 0.0</span>
</span><span id="__span-0-959"><a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-960"><a id="__codelineno-0-960" name="__codelineno-0-960"></a>
</span><span id="__span-0-961"><a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        tr = jax.jit(inc.simulate)(key, (init,))</span>
</span><span id="__span-0-962"><a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-963"><a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">        ```</span>
</span><span id="__span-0-964"><a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-965"><a id="__codelineno-0-965" name="__codelineno-0-965"></a>
</span><span id="__span-0-966"><a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]:</span>
</span><span id="__span-0-967"><a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="c1"># strip off the JAX-supplied `None` on the way in, accumulate `ret` on the way out.</span>
</span><span id="__span-0-968"><a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-969"><a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="n">f</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span>
</span><span id="__span-0-970"><a id="__codelineno-0-970" name="__codelineno-0-970"></a>                <span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a>                <span class="n">post</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_args</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ret</span><span class="p">),</span>
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a>            <span class="p">)</span>
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a>            <span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">post</span><span class="o">=</span><span class="n">prepend_initial_acc</span><span class="p">)</span>
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="p">)</span>
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a>
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.iterate_final" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.iterate_final</span>


<a href="#genjax.iterate_final" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">iterate_final</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;n&lt;/code&gt; (&lt;code&gt;genjax.iterate_final(n)&lt;/code&gt;)" href="#genjax.iterate_final(n)">n</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type
<code>a -&gt; a</code> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> of type <code>a -&gt; a</code>
where.</p>
<ul>
<li><code>a</code> is a loop-carried value, which must hold a fixed shape and dtype across all iterations</li>
<li>the original function is invoked <code>n</code> times with each input coming from the previous invocation's output, so that the new function returns <span class="arithmatex">\(f^n(a)\)</span></li>
</ul>
<p>All traced values are nested under an index.</p>
<p>The semantics of the returned <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> are given roughly by this Python implementation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">iterate_final</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">init</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">init</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">ret</span>
</span></code></pre></div>
<p><code>init</code> may be an arbitrary pytree value, and so multiple arrays can be iterated over at once and produce multiple output arrays.</p>
<p>The iterated value <code>a</code> must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type <code>a</code> in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.iterate_final(n)" class="doc doc-heading doc-heading-parameter">                  <code>n</code>
<a href="#genjax.iterate_final(n)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of iterations to run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>iterative addition:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">iterate_final</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">init</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">inc</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">init</span><span class="p">,))</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_18e38eb57bcc41609c9e5687dd47d179" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_18e38eb57bcc41609c9e5687dd47d179")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_18e38eb57bcc41609c9e5687dd47d179")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="k">def</span><span class="w"> </span><span class="nf">iterate_final</span><span class="p">(</span>
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a>    <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]]:</span>
</span><span id="__span-0-983"><a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a decorator that wraps a [`genjax.GenerativeFunction`][] of type</span>
</span><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    `a -&gt; a` and returns a new [`genjax.GenerativeFunction`][] of type `a -&gt; a`</span>
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    where.</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a>
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    - `a` is a loop-carried value, which must hold a fixed shape and dtype across all iterations</span>
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">    - the original function is invoked `n` times with each input coming from the previous invocation&#39;s output, so that the new function returns $f^n(a)$</span>
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">    All traced values are nested under an index.</span>
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a>
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">    The semantics of the returned [`genjax.GenerativeFunction`][] are given roughly by this Python implementation:</span>
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">    ```python</span>
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">    def iterate_final(f, n, init):</span>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        ret = init</span>
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        for _ in range(n):</span>
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">            ret = f(ret)</span>
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">        return ret</span>
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">    ```</span>
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">    `init` may be an arbitrary pytree value, and so multiple arrays can be iterated over at once and produce multiple output arrays.</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">    The iterated value `a` must hold a fixed shape and dtype across all iterations (and not just be consistent up to NumPy rank/shape broadcasting and dtype promotion rules, for example). In other words, the type `a` in the type signature above represents an array with a fixed shape and dtype (or a nested tuple/list/dict container data structure with a fixed structure and arrays with fixed shape and dtype at the leaves).</span>
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">        n: the number of iterations to run.</span>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-1010"><a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">        iterative addition:</span>
</span><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">        import jax</span>
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">        @genjax.iterate_final(n=100)</span>
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">        def inc(x):</span>
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">            return x + 1</span>
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">        init = 0.0</span>
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
</span><span id="__span-0-1025"><a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="sd">        tr = jax.jit(inc.simulate)(key, (init,))</span>
</span><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">        ```</span>
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]:</span>
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="c1"># strip off the JAX-supplied `None` on the way in, no accumulation on the way out.</span>
</span><span id="__span-0-1032"><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">pre_post</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="n">Y</span><span class="p">):</span>
</span><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">post_post</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>            <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1037"><a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>
</span><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>            <span class="n">f</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">post</span><span class="o">=</span><span class="n">pre_post</span><span class="p">)</span>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">post</span><span class="o">=</span><span class="n">post_post</span><span class="p">)</span>
</span><span id="__span-0-1042"><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="p">)</span>
</span><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.masked_iterate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.masked_iterate</span>


<a href="#genjax.masked_iterate" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">masked_iterate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Transforms a generative function that takes a single argument of type <code>a</code> and returns a value of type <code>a</code>, into a function that takes a tuple of arguments <code>(a, [mask])</code> and returns a list of values of type <code>a</code>.</p>
<p>The original function is modified to accept an additional argument <code>mask</code>, which is a boolean value indicating whether the operation should be masked or not. The function returns a Masked list of results of the original operation with the input [mask] as mask.</p>
<p>All traced values from the kernel generative function are traced (with an added axis due to the scan) but only those indices from [mask] with a flag of True will accounted for in inference, notably for score computations.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">masks</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Create a kernel generative function</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">masks</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="o">@</span> <span class="s2">&quot;rats&quot;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># Create a model using masked_iterate</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">model</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">masked_iterate</span><span class="p">()(</span><span class="n">step</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Simulate from the model</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">mask_steps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">mask_steps</span><span class="p">))</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_16db91a95a1d436eafb965c71241f142" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_16db91a95a1d436eafb965c71241f142")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_16db91a95a1d436eafb965c71241f142")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1101"><a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="k">def</span><span class="w"> </span><span class="nf">masked_iterate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]]:</span>
</span><span id="__span-0-1102"><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1103"><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="sd">    Transforms a generative function that takes a single argument of type `a` and returns a value of type `a`, into a function that takes a tuple of arguments `(a, [mask])` and returns a list of values of type `a`.</span>
</span><span id="__span-0-1104"><a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>
</span><span id="__span-0-1105"><a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">    The original function is modified to accept an additional argument `mask`, which is a boolean value indicating whether the operation should be masked or not. The function returns a Masked list of results of the original operation with the input [mask] as mask.</span>
</span><span id="__span-0-1106"><a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
</span><span id="__span-0-1107"><a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">    All traced values from the kernel generative function are traced (with an added axis due to the scan) but only those indices from [mask] with a flag of True will accounted for in inference, notably for score computations.</span>
</span><span id="__span-0-1108"><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>
</span><span id="__span-0-1109"><a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">    Example:</span>
</span><span id="__span-0-1110"><a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-1111"><a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">        import jax</span>
</span><span id="__span-0-1112"><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-1113"><a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>
</span><span id="__span-0-1114"><a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">        masks = jnp.array([True, False, True])</span>
</span><span id="__span-0-1115"><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
</span><span id="__span-0-1116"><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
</span><span id="__span-0-1117"><a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        # Create a kernel generative function</span>
</span><span id="__span-0-1118"><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-1119"><a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        def step(x):</span>
</span><span id="__span-0-1120"><a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">            _ = (</span>
</span><span id="__span-0-1121"><a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">                genjax.normal.mask().vmap(in_axes=(0, None, None))(masks, x, 1.0)</span>
</span><span id="__span-0-1122"><a id="__codelineno-0-1122" name="__codelineno-0-1122"></a><span class="sd">                @ &quot;rats&quot;</span>
</span><span id="__span-0-1123"><a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><span class="sd">            )</span>
</span><span id="__span-0-1124"><a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="sd">            return x</span>
</span><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        # Create a model using masked_iterate</span>
</span><span id="__span-0-1128"><a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">        model = genjax.masked_iterate()(step)</span>
</span><span id="__span-0-1129"><a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
</span><span id="__span-0-1130"><a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        # Simulate from the model</span>
</span><span id="__span-0-1131"><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-1132"><a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        mask_steps = jnp.arange(10) &lt; 5</span>
</span><span id="__span-0-1133"><a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        tr = model.simulate(key, (0.0, mask_steps))</span>
</span><span id="__span-0-1134"><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-1135"><a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        ```</span>
</span><span id="__span-0-1136"><a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1137"><a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>
</span><span id="__span-0-1138"><a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]:</span>
</span><span id="__span-0-1139"><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">pre</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">Flag</span><span class="p">):</span>
</span><span id="__span-0-1140"><a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">state</span>
</span><span id="__span-0-1141"><a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>
</span><span id="__span-0-1142"><a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">_unused_args</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">masked_retval</span><span class="p">:</span> <span class="n">Mask</span><span class="p">[</span><span class="n">Y</span><span class="p">]):</span>
</span><span id="__span-0-1143"><a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">masked_retval</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-0-1144"><a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            <span class="k">return</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span>
</span><span id="__span-0-1145"><a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>
</span><span id="__span-0-1146"><a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="c1"># scan_step: (a, bool) -&gt; a</span>
</span><span id="__span-0-1147"><a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="n">scan_step</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
</span><span id="__span-0-1148"><a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="k">return</span> <span class="n">scan_step</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">prepend_initial_acc</span><span class="p">)</span>
</span><span id="__span-0-1149"><a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>
</span><span id="__span-0-1150"><a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.masked_iterate_final" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.masked_iterate_final</span>


<a href="#genjax.masked_iterate_final" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">masked_iterate_final</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.scan.Y">Y</span></span><span class="p">]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Transforms a generative function that takes a single argument of type <code>a</code> and returns a value of type <code>a</code>, into a function that takes a tuple of arguments <code>(a, [mask])</code> and returns a value of type <code>a</code>.</p>
<p>The original function is modified to accept an additional argument <code>mask</code>, which is a boolean value indicating whether the operation should be masked or not. The function returns the result of the original operation if <code>mask</code> is <code>True</code>, and the original input if <code>mask</code> is <code>False</code>.</p>
<p>All traced values from the kernel generative function are traced (with an added axis due to the scan) but only those indices from [mask] with a flag of True will accounted for in inference, notably for score computations.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">masks</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Create a kernel generative function</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">masks</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="o">@</span> <span class="s2">&quot;rats&quot;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># Create a model using masked_iterate_final</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">model</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">masked_iterate_final</span><span class="p">()(</span><span class="n">step</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Simulate from the model</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">mask_steps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">mask_steps</span><span class="p">))</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_f86e43b20c77441dae037b60f5a23c1e" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_f86e43b20c77441dae037b60f5a23c1e")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_f86e43b20c77441dae037b60f5a23c1e")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/scan.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="k">def</span><span class="w"> </span><span class="nf">masked_iterate_final</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]],</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]]:</span>
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">    Transforms a generative function that takes a single argument of type `a` and returns a value of type `a`, into a function that takes a tuple of arguments `(a, [mask])` and returns a value of type `a`.</span>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    The original function is modified to accept an additional argument `mask`, which is a boolean value indicating whether the operation should be masked or not. The function returns the result of the original operation if `mask` is `True`, and the original input if `mask` is `False`.</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">    All traced values from the kernel generative function are traced (with an added axis due to the scan) but only those indices from [mask] with a flag of True will accounted for in inference, notably for score computations.</span>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">    Example:</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;scan&quot;</span>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        import jax</span>
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">        masks = jnp.array([True, False, True])</span>
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        # Create a kernel generative function</span>
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">        def step(x):</span>
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">            _ = (</span>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">                genjax.normal.mask().vmap(in_axes=(0, None, None))(masks, x, 1.0)</span>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">                @ &quot;rats&quot;</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">            )</span>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">            return x</span>
</span><span id="__span-0-1074"><a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
</span><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">        # Create a model using masked_iterate_final</span>
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">        model = genjax.masked_iterate_final()(step)</span>
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        # Simulate from the model</span>
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        mask_steps = jnp.arange(10) &lt; 5</span>
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        tr = model.simulate(key, (0.0, mask_steps))</span>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        ```</span>
</span><span id="__span-0-1085"><a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1086"><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
</span><span id="__span-0-1087"><a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">Y</span><span class="p">]:</span>
</span><span id="__span-0-1088"><a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">pre</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">Flag</span><span class="p">):</span>
</span><span id="__span-0-1089"><a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">state</span>
</span><span id="__span-0-1090"><a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>
</span><span id="__span-0-1091"><a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">_unused_args</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">masked_retval</span><span class="p">:</span> <span class="n">Mask</span><span class="p">[</span><span class="n">Y</span><span class="p">]):</span>
</span><span id="__span-0-1092"><a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>            <span class="k">return</span> <span class="n">masked_retval</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-1093"><a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
</span><span id="__span-0-1094"><a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="c1"># scan_step: (a, bool) -&gt; a</span>
</span><span id="__span-0-1095"><a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="n">scan_step</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
</span><span id="__span-0-1096"><a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="k">return</span> <span class="n">scan_step</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ret</span><span class="p">:</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-1097"><a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>
</span><span id="__span-0-1098"><a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="control-flow-combinators">Control Flow Combinators<a class="headerlink" href="#control-flow-combinators" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="genjax.or_else" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.or_else</span>


<a href="#genjax.or_else" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">or_else</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="genjax.or_else(if_gen_fn)">if_gen_fn</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.or_else.R">R</span></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;else_gen_fn&lt;/code&gt; (&lt;code&gt;genjax.or_else(else_gen_fn)&lt;/code&gt;)" href="#genjax.or_else(else_gen_fn)">else_gen_fn</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.or_else.R">R</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.or_else.R">R</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Given two <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a>s <code>if_gen_fn</code> and <code>else_gen_fn</code>, returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> that accepts</p>
<ul>
<li>a boolean argument</li>
<li>an argument tuple for <code>if_gen_fn</code></li>
<li>an argument tuple for the supplied <code>else_gen_fn</code></li>
</ul>
<p>and acts like <code>if_gen_fn</code> when the boolean is <code>True</code> or <code>else_gen_fn</code> otherwise.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.or_else(else_gen_fn)" class="doc doc-heading doc-heading-parameter">                  <code>else_gen_fn</code>
<a href="#genjax.or_else(else_gen_fn)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.or_else.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>called when the boolean argument is <code>False</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.or_else.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> modified for conditional execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">if_model</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;if_value&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">else_model</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;else_value&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">or_else_model</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">or_else</span><span class="p">(</span><span class="n">if_model</span><span class="p">,</span> <span class="n">else_model</span><span class="p">)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">toss</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="c1"># Note that `or_else_model` takes a new boolean predicate in</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="c1"># addition to argument tuples for each branch.</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="k">return</span> <span class="n">or_else_model</span><span class="p">(</span><span class="n">toss</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,),</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,))</span> <span class="o">@</span> <span class="s2">&quot;tossed&quot;</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="kc">True</span><span class="p">,))</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_2550398e5826472f8fb77bd0816ffa47" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_2550398e5826472f8fb77bd0816ffa47")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_2550398e5826472f8fb77bd0816ffa47")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/or_else.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">or_else</span><span class="p">(</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">if_gen_fn</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">],</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">else_gen_fn</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">],</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Given two [`genjax.GenerativeFunction`][]s `if_gen_fn` and `else_gen_fn`, returns a new [`genjax.GenerativeFunction`][] that accepts</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    - a boolean argument</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    - an argument tuple for `if_gen_fn`</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    - an argument tuple for the supplied `else_gen_fn`</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    and acts like `if_gen_fn` when the boolean is `True` or `else_gen_fn` otherwise.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        else_gen_fn: called when the boolean argument is `False`.</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        A [`genjax.GenerativeFunction`][] modified for conditional execution.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;or_else&quot;</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        import jax</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        import jax.numpy as jnp</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        def if_model(x):</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            return genjax.normal(x, 1.0) @ &quot;if_value&quot;</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        def else_model(x):</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            return genjax.normal(x, 5.0) @ &quot;else_value&quot;</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        or_else_model = genjax.or_else(if_model, else_model)</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        def model(toss: bool):</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            # Note that `or_else_model` takes a new boolean predicate in</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            # addition to argument tuples for each branch.</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            return or_else_model(toss, (1.0,), (10.0,)) @ &quot;tossed&quot;</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        tr = jax.jit(model.simulate)(key, (True,))</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        ```</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">argument_mapping</span><span class="p">(</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">b</span><span class="p">:</span> <span class="n">ScalarFlag</span><span class="p">,</span> <span class="n">if_args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">else_args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="c1"># Note that `True` maps to 0 to select the &quot;if&quot; branch, `False` to 1.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">if_args</span><span class="p">,</span> <span class="n">else_args</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">return</span> <span class="n">if_gen_fn</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">else_gen_fn</span><span class="p">)</span><span class="o">.</span><span class="n">contramap</span><span class="p">(</span><span class="n">argument_mapping</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.switch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.switch</span>


<a href="#genjax.switch" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">switch</span><span class="p">(</span><span class="o">*</span><span class="n"><span title="genjax.switch(*gen_fns)">gen_fns</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.switch.R">R</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.generative_functions.combinators.switch.Switch">Switch</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.switch.R">R</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Given <code>n</code> <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> inputs, returns a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> that accepts <code>n+1</code> arguments:</p>
<ul>
<li>an index in the range <span class="arithmatex">\([0, n)\)</span></li>
<li>a tuple of arguments for each of the input generative functions (<code>n</code> total tuples)</li>
</ul>
<p>and executes the generative function at the supplied index with its provided arguments.</p>
<p>If <code>index</code> is out of bounds, <code>index</code> is clamped to within bounds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.switch(gen_fns)" class="doc doc-heading doc-heading-parameter">                  <code>gen_fns</code>
<a href="#genjax.switch(gen_fns)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.switch.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>generative functions that the <code>Switch</code> will select from.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Create a <code>Switch</code> via the <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.switch&lt;/span&gt;" href="#genjax.switch"><code>genjax.switch</code></a> method:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">branch_1</span><span class="p">():</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;x1&quot;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">branch_2</span><span class="p">():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">probs</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;x2&quot;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">switch</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">branch_1</span><span class="p">,</span> <span class="n">branch_2</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">jitted</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">switch</span><span class="o">.</span><span class="n">simulate</span><span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># Select `branch_2` by providing 1:</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jitted</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(),</span> <span class="p">()))</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_e6eab42d4f754cc0be95bdf64aec10a1" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e6eab42d4f754cc0be95bdf64aec10a1")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e6eab42d4f754cc0be95bdf64aec10a1")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/switch.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="k">def</span><span class="w"> </span><span class="nf">switch</span><span class="p">(</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="o">*</span><span class="n">gen_fns</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">],</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Switch</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    Given `n` [`genjax.GenerativeFunction`][] inputs, returns a [`genjax.GenerativeFunction`][] that accepts `n+1` arguments:</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    - an index in the range $[0, n)$</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    - a tuple of arguments for each of the input generative functions (`n` total tuples)</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    and executes the generative function at the supplied index with its provided arguments.</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    If `index` is out of bounds, `index` is clamped to within bounds.</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    Args:</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        gen_fns: generative functions that the `Switch` will select from.</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        Create a `Switch` via the [`genjax.switch`][] method:</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;switch&quot;</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        import jax, genjax</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        def branch_1():</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            x = genjax.normal(0.0, 1.0) @ &quot;x1&quot;</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        def branch_2():</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            x = genjax.bernoulli(probs=0.3) @ &quot;x2&quot;</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        switch = genjax.switch(branch_1, branch_2)</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        jitted = jax.jit(switch.simulate)</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        # Select `branch_2` by providing 1:</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        tr = jitted(key, (1, (), ()))</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        ```</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">return</span> <span class="n">Switch</span><span class="p">[</span><span class="n">R</span><span class="p">](</span><span class="n">gen_fns</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="argument-and-return-transformations">Argument and Return Transformations<a class="headerlink" href="#argument-and-return-transformations" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="genjax.dimap" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.dimap</span>


<a href="#genjax.dimap" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">dimap</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;pre&lt;/code&gt; (&lt;code&gt;genjax.dimap(pre)&lt;/code&gt;)" href="#genjax.dimap(pre)">pre</a></span><span class="p">:</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span></span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n"><span title="args">args</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;post&lt;/code&gt; (&lt;code&gt;genjax.dimap(post)&lt;/code&gt;)" href="#genjax.dimap(post)">post</a></span><span class="p">:</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="p">[</span><span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="genjax._src.core.typing.Any">Any</span></span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.S">S</span></span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">retval</span><span class="p">:</span> <span class="n"><span title="retval">retval</span></span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">]],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.S">S</span></span><span class="p">]</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and applies pre- and post-processing functions to its arguments and return value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Prefer <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.map&lt;/span&gt;" href="#genjax.map"><code>genjax.map</code></a> if you only need to transform the return value, or <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.contramap&lt;/span&gt;" href="#genjax.contramap"><code>genjax.contramap</code></a> if you need to transform the arguments.</p>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.dimap(pre)" class="doc doc-heading doc-heading-parameter">                  <code>pre</code>
<a href="#genjax.dimap(pre)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[..., <span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callable that preprocesses the arguments before passing them to the wrapped function. Note that <code>pre</code> must return a <em>tuple</em> of arguments, not a bare argument. Default is the identity function.</p>
              </div>
            </td>
            <td>
                  <code>lambda *args: <span title="args">args</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.dimap(post)" class="doc doc-heading doc-heading-parameter">                  <code>post</code>
<a href="#genjax.dimap(post)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<span title="tuple">tuple</span>[<span title="genjax._src.core.typing.Any">Any</span>, ...], <span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span>, <span title="genjax._src.generative_functions.combinators.dimap.R">R</span>], <span title="genjax._src.generative_functions.combinators.dimap.S">S</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callable that postprocesses the return value of the wrapped function. Default is the identity function.</p>
              </div>
            </td>
            <td>
                  <code>lambda _, _xformed, retval: <span title="retval">retval</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.dimap.R">R</span>]], <span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span>[<span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span>, <span title="genjax._src.generative_functions.combinators.dimap.R">R</span>, <span title="genjax._src.generative_functions.combinators.dimap.S">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A decorator that takes a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> with the same behavior but with the arguments and return value transformed according to <code>pre</code> and <code>post</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Define pre- and post-processing functions</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">pre_process</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">post_process</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">xformed</span><span class="p">,</span> <span class="n">retval</span><span class="p">):</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">return</span> <span class="n">retval</span><span class="o">**</span><span class="mi">2</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1"># Apply dimap to a generative function</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="n">pre_process</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post_process</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">dimap_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;z&quot;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Use the dimap model</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">dimap_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_e5c6a6cc0a174d9c902ca9cdb64566eb" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e5c6a6cc0a174d9c902ca9cdb64566eb")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e5c6a6cc0a174d9c902ca9cdb64566eb")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/dimap.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="k">def</span><span class="w"> </span><span class="nf">dimap</span><span class="p">(</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">pre</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ArgTuple</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">post</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">ArgTuple</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span> <span class="n">S</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">_xformed</span><span class="p">,</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">retval</span><span class="p">:</span> <span class="n">retval</span><span class="p">,</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]],</span> <span class="n">Dimap</span><span class="p">[</span><span class="n">ArgTuple</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    Returns a decorator that wraps a [`genjax.GenerativeFunction`][] and applies pre- and post-processing functions to its arguments and return value.</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    !!! info</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        Prefer [`genjax.map`][] if you only need to transform the return value, or [`genjax.contramap`][] if you need to transform the arguments.</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Args:</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        pre: A callable that preprocesses the arguments before passing them to the wrapped function. Note that `pre` must return a _tuple_ of arguments, not a bare argument. Default is the identity function.</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        post: A callable that postprocesses the return value of the wrapped function. Default is the identity function.</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        A decorator that takes a [`genjax.GenerativeFunction`][] and returns a new [`genjax.GenerativeFunction`][] with the same behavior but with the arguments and return value transformed according to `pre` and `post`.</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;dimap&quot;</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        import jax, genjax</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        # Define pre- and post-processing functions</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        def pre_process(x, y):</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            return (x + 1, y * 2)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        def post_process(args, xformed, retval):</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            return retval**2</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        # Apply dimap to a generative function</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        @genjax.dimap(pre=pre_process, post=post_process)</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        def dimap_model(x, y):</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">            return genjax.normal(x, y) @ &quot;z&quot;</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        # Use the dimap model</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        trace = dimap_model.simulate(key, (2.0, 3.0))</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        print(trace.render_html())</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        ```</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dimap</span><span class="p">[</span><span class="n">ArgTuple</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">]:</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">return</span> <span class="n">Dimap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">return</span> <span class="n">decorator</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.map" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.map</span>


<a href="#genjax.map" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;f&lt;/code&gt; (&lt;code&gt;genjax.map(f)&lt;/code&gt;)" href="#genjax.map(f)">f</a></span><span class="p">:</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.S">S</span></span><span class="p">]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">]],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span></span><span class="p">[</span><span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="genjax._src.core.typing.Any">Any</span></span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.S">S</span></span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and applies a post-processing function to its return value.</p>
<p>This is a specialized version of <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.dimap&lt;/span&gt;" href="#genjax.dimap"><code>genjax.dimap</code></a> where only the post-processing function is applied.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.map(f)" class="doc doc-heading doc-heading-parameter">                  <code>f</code>
<a href="#genjax.map(f)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<span title="genjax._src.generative_functions.combinators.dimap.R">R</span>], <span title="genjax._src.generative_functions.combinators.dimap.S">S</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callable that postprocesses the return value of the wrapped function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.dimap.R">R</span>]], <span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span>[<span title="tuple">tuple</span>[<span title="genjax._src.core.typing.Any">Any</span>, ...], <span title="genjax._src.generative_functions.combinators.dimap.R">R</span>, <span title="genjax._src.generative_functions.combinators.dimap.S">S</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A decorator that takes a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> with the same behavior but with the return value transformed according to <code>f</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Define a post-processing function</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1"># Apply map to a generative function</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_model</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;z&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># Use the map model</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">map_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,))</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_e9381bc9ebce4c8cb0324c79b07ce25d" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e9381bc9ebce4c8cb0324c79b07ce25d")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_e9381bc9ebce4c8cb0324c79b07ce25d")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/dimap.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">R</span><span class="p">],</span> <span class="n">S</span><span class="p">],</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]],</span> <span class="n">Dimap</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">]]:</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    Returns a decorator that wraps a [`genjax.GenerativeFunction`][] and applies a post-processing function to its return value.</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    This is a specialized version of [`genjax.dimap`][] where only the post-processing function is applied.</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    Args:</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        f: A callable that postprocesses the return value of the wrapped function.</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        A decorator that takes a [`genjax.GenerativeFunction`][] and returns a new [`genjax.GenerativeFunction`][] with the same behavior but with the return value transformed according to `f`.</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;map&quot;</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        import jax, genjax</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        # Define a post-processing function</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        def square(x):</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            return x**2</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        # Apply map to a generative function</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        @genjax.map(square)</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        def map_model(x):</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            return genjax.normal(x, 1.0) @ &quot;z&quot;</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        # Use the map model</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        trace = map_model.simulate(key, (2.0,))</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        print(trace.render_html())</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        ```</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">_args</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">S</span><span class="p">:</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">return</span> <span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.contramap" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.contramap</span>


<a href="#genjax.contramap" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">contramap</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;f&lt;/code&gt; (&lt;code&gt;genjax.contramap(f)&lt;/code&gt;)" href="#genjax.contramap(f)">f</a></span><span class="p">:</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span></span><span class="p">]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.core.typing.Callable">Callable</span></span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">]],</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">,</span> <span class="n"><span title="genjax._src.generative_functions.combinators.dimap.R">R</span></span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Returns a decorator that wraps a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and applies a pre-processing function to its arguments.</p>
<p>This is a specialized version of <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-function&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;genjax.dimap&lt;/span&gt;" href="#genjax.dimap"><code>genjax.dimap</code></a> where only the pre-processing function is applied.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.contramap(f)" class="doc doc-heading doc-heading-parameter">                  <code>f</code>
<a href="#genjax.contramap(f)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[..., <span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A callable that preprocesses the arguments of the wrapped function. Note that <code>f</code> must return a <em>tuple</em> of arguments, not a bare argument.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.core.typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.dimap.R">R</span>]], <span title="genjax._src.generative_functions.combinators.dimap.Dimap">Dimap</span>[<span title="genjax._src.generative_functions.combinators.dimap.ArgTuple">ArgTuple</span>, <span title="genjax._src.generative_functions.combinators.dimap.R">R</span>, <span title="genjax._src.generative_functions.combinators.dimap.R">R</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A decorator that takes a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> with the same behavior but with the arguments transformed according to <code>f</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span><span class="o">,</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Define a pre-processing function.</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># Note that this function must return a tuple of arguments!</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1"># Apply contramap to a generative function</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">contramap</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">contramap_model</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;z&quot;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># Use the contramap model</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">contramap_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,))</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_c414b12b230b4920ba14cb15280844cb" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_c414b12b230b4920ba14cb15280844cb")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_c414b12b230b4920ba14cb15280844cb")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/dimap.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="k">def</span><span class="w"> </span><span class="nf">contramap</span><span class="p">(</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ArgTuple</span><span class="p">],</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]],</span> <span class="n">Dimap</span><span class="p">[</span><span class="n">ArgTuple</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">]]:</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    Returns a decorator that wraps a [`genjax.GenerativeFunction`][] and applies a pre-processing function to its arguments.</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    This is a specialized version of [`genjax.dimap`][] where only the pre-processing function is applied.</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Args:</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        f: A callable that preprocesses the arguments of the wrapped function. Note that `f` must return a _tuple_ of arguments, not a bare argument.</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        A decorator that takes a [`genjax.GenerativeFunction`][] and returns a new [`genjax.GenerativeFunction`][] with the same behavior but with the arguments transformed according to `f`.</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;contramap&quot;</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        import jax, genjax</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        # Define a pre-processing function.</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        # Note that this function must return a tuple of arguments!</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        def add_one(x):</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            return (x + 1,)</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        # Apply contramap to a generative function</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        @genjax.contramap(add_one)</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        def contramap_model(x):</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">            return genjax.normal(x, 1.0) @ &quot;z&quot;</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        # Use the contramap model</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        trace = contramap_model.simulate(key, (2.0,))</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">        print(trace.render_html())</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        ```</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">return</span> <span class="n">dimap</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_args</span><span class="p">,</span> <span class="n">_xformed</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="n">ret</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="the-rest">The Rest<a class="headerlink" href="#the-rest" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="genjax.mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.mask</span>


<a href="#genjax.mask" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">mask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;f&lt;/code&gt; (&lt;code&gt;genjax.mask(f)&lt;/code&gt;)" href="#genjax.mask(f)">f</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.mask.R">R</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="genjax._src.generative_functions.combinators.mask.MaskCombinator">MaskCombinator</span></span><span class="p">[</span><span class="n"><span title="genjax._src.generative_functions.combinators.mask.R">R</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Combinator which enables dynamic masking of generative functions. Takes a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> and returns a new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> which accepts an additional boolean first argument.</p>
<p>If <code>True</code>, the invocation of the generative function is masked, and its contribution to the score is ignored. If <code>False</code>, it has the same semantics as if one was invoking the generative function without masking.</p>
<p>The return value type is a <code>Mask</code>, with a flag value equal to the supplied boolean.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.mask(f)" class="doc doc-heading doc-heading-parameter">                  <code>f</code>
<a href="#genjax.mask(f)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.generative_functions.combinators.mask.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generative function to be masked.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="genjax._src.generative_functions.combinators.mask.MaskCombinator">MaskCombinator</span>[<span title="genjax._src.generative_functions.combinators.mask.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The masked version of the input generative function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Masking a normal draw:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span><span class="o">,</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">mask</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">masked_normal_draw</span><span class="p">(</span><span class="n">mean</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;x&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">314159</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">tr</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">masked_normal_draw</span><span class="o">.</span><span class="n">simulate</span><span class="p">)(</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">key</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        <span class="mf">2.0</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="p">),</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_0f37fa89fd5349cbbec37ba90e00f70d" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_0f37fa89fd5349cbbec37ba90e00f70d")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_0f37fa89fd5349cbbec37ba90e00f70d")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div></p>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/mask.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MaskCombinator</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    Combinator which enables dynamic masking of generative functions. Takes a [`genjax.GenerativeFunction`][] and returns a new [`genjax.GenerativeFunction`][] which accepts an additional boolean first argument.</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    If `True`, the invocation of the generative function is masked, and its contribution to the score is ignored. If `False`, it has the same semantics as if one was invoking the generative function without masking.</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    The return value type is a `Mask`, with a flag value equal to the supplied boolean.</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    Args:</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        f: The generative function to be masked.</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        The masked version of the input generative function.</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        Masking a normal draw:</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;mask&quot;</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        import genjax, jax</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        @genjax.mask</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        def masked_normal_draw(mean):</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">            return genjax.normal(mean, 1.0) @ &quot;x&quot;</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        key = jax.random.key(314159)</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        tr = jax.jit(masked_normal_draw.simulate)(</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">            key,</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">            (</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">                False,</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">                2.0,</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">            ),</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        )</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        print(tr.render_html())</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        ```</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">return</span> <span class="n">MaskCombinator</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="genjax.mix" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">genjax.mix</span>


<a href="#genjax.mix" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">mix</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code&gt;*gen_fns&lt;/code&gt; (&lt;code&gt;genjax.mix(*gen_fns)&lt;/code&gt;)" href="#genjax.mix(*gen_fns)">gen_fns</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.core.generative.concepts.R">R</span></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a></span><span class="p">[</span><span class="n"><span title="genjax._src.core.generative.concepts.R">R</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Creates a mixture model from a set of generative functions.</p>
<p>This function takes multiple generative functions as input and returns a new generative function that represents a mixture model.</p>
<p>The returned generative function takes the following arguments:</p>
<ul>
<li><code>mixture_logits</code>: Logits for the categorical distribution used to select a component.</li>
<li><code>*args</code>: Argument tuples for each of the input generative functions</li>
</ul>
<p>and samples from one of the input generative functions based on draw from a categorical distribution defined by the provided mixture logits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h3 id="genjax.mix(*gen_fns)" class="doc doc-heading doc-heading-parameter">                  <code>*gen_fns</code>
<a href="#genjax.mix(*gen_fns)" class="headerlink" title="Permanent link">&para;</a></h3>            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.core.generative.concepts.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable number of <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a>s to be mixed.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt; (&lt;code&gt;genjax._src.core.generative.GenerativeFunction&lt;/code&gt;)" href="core.html#genjax.core.GenerativeFunction">GenerativeFunction</a>[<span title="genjax._src.core.generative.concepts.R">R</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;genjax.core.GenerativeFunction&lt;/span&gt;" href="core.html#genjax.core.GenerativeFunction"><code>genjax.GenerativeFunction</code></a> representing the mixture model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">genjax</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># Define component generative functions</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">component1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;y&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nd">@genjax</span><span class="o">.</span><span class="n">gen</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">component2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="k">return</span> <span class="n">genjax</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;y&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># Create mixture model</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">mixture</span> <span class="o">=</span> <span class="n">genjax</span><span class="o">.</span><span class="n">mix</span><span class="p">(</span><span class="n">component1</span><span class="p">,</span> <span class="n">component2</span><span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># Use the mixture model</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">logits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>  <span class="c1"># Favors component2</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">mixture</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,),</span> <span class="p">(</span><span class="mf">7.0</span><span class="p">,)))</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">render_html</span><span class="p">())</span>
</span></code></pre></div>
<div class="result">
<script> (()=>{ if (customElements.get('treescope-container') === undefined) { class TreescopeContainer extends HTMLElement { constructor() { super(); this.attachShadow({mode: "open"}); this.defns = {}; this.state = {}; } } customElements.define("treescope-container", TreescopeContainer); } if (customElements.get('treescope-run-here') === undefined) { class RunHere extends HTMLElement { constructor() { super() } connectedCallback() { const run = child => { const fn = new Function(child.textContent); child.textContent = ""; fn.call(this); this.remove(); }; const child = this.querySelector("script"); if (child) { run(child); } else { new MutationObserver(()=>{ run(this.querySelector("script")); }).observe(this, {childList: true}); } } } customElements.define("treescope-run-here", RunHere); } })(); </script> <treescope-container class="treescope_out_37c31020295f4650a7992296c11393d7" style="display:block"></treescope-container> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_37c31020295f4650a7992296c11393d7")) .filter((elt) => !elt.dataset.setup) )[0]; root.dataset.setup = 1; const msg = document.createElement("span"); msg.style = "color: #cccccc; font-family: monospace;"; msg.textContent = "(Loading...)"; root.state.loadingMsg = msg; root.shadowRoot.appendChild(msg); root.state.chain = new Promise((resolve, reject) => { const observer = new IntersectionObserver((entries) => { for (const entry of entries) { if (entry.isIntersecting) { resolve(); observer.disconnect(); return; } } }, {rootMargin: "1000px"}); window.setTimeout(() => { observer.observe(root); }, 0); }); root.state.deferring = false; const _insertNode = (node) => { for (let oldScript of node.querySelectorAll("script")) { let newScript = document.createElement("script"); newScript.type = oldScript.type; newScript.textContent = oldScript.textContent; oldScript.parentNode.replaceChild(newScript, oldScript); } if (root.state.loadingMsg) { root.state.loadingMsg.remove(); root.state.loadingMsg = null; } root.shadowRoot.appendChild(node); }; root.defns.insertContent = ((contentNode, compressed) => { if (compressed) { root.state.deferring = true; } if (root.state.deferring) { root.state.chain = (async () => { await root.state.chain; if (compressed) { const encoded = contentNode.textContent; const blob = new Blob([ Uint8Array.from(atob(encoded), (m) => m.codePointAt(0)) ]); const reader = blob.stream().pipeThrough( new DecompressionStream("deflate") ).pipeThrough( new TextDecoderStream("utf-8") ).getReader(); const parts = []; while (true) { const step = await reader.read(); if (step.done) { break; } parts.push(step.value); } const tpl = document.createElement('template'); tpl.innerHTML = parts.join(""); _insertNode(tpl.content); } else { _insertNode(contentNode.content); } })(); } else { _insertNode(contentNode.content); } }); </script></treescope-run-here><div style="display:none"> <script type="application/octet-stream" >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</script> <treescope-run-here><script type="application/octet-stream"> const root = ( Array.from(document.getElementsByClassName( "treescope_out_37c31020295f4650a7992296c11393d7")) .filter((elt) => !elt.dataset['step0']) )[0]; root.dataset['step0'] = 1; root.defns.insertContent( this.parentNode.querySelector('script[type="application/octet-stream"]'), true ); this.parentNode.remove(); </script></treescope-run-here> </div>

</div>


            <details class="quote">
              <summary>Source code in <code>src/genjax/_src/generative_functions/combinators/mixture.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">def</span><span class="w"> </span><span class="nf">mix</span><span class="p">(</span><span class="o">*</span><span class="n">gen_fns</span><span class="p">:</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">GenerativeFunction</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Creates a mixture model from a set of generative functions.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    This function takes multiple generative functions as input and returns a new generative function that represents a mixture model.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    The returned generative function takes the following arguments:</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    - `mixture_logits`: Logits for the categorical distribution used to select a component.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    - `*args`: Argument tuples for each of the input generative functions</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    and samples from one of the input generative functions based on draw from a categorical distribution defined by the provided mixture logits.</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    Args:</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        *gen_fns: Variable number of [`genjax.GenerativeFunction`][]s to be mixed.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        A new [`genjax.GenerativeFunction`][] representing the mixture model.</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Examples:</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        ```python exec=&quot;yes&quot; html=&quot;true&quot; source=&quot;material-block&quot; session=&quot;mix&quot;</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        import jax</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        import genjax</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        # Define component generative functions</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        def component1(x):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            return genjax.normal(x, 1.0) @ &quot;y&quot;</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        @genjax.gen</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        def component2(x):</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            return genjax.normal(x, 2.0) @ &quot;y&quot;</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        # Create mixture model</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        mixture = genjax.mix(component1, component2)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        # Use the mixture model</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        key = jax.random.key(0)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        logits = jax.numpy.array([0.3, 0.7])  # Favors component2</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        trace = mixture.simulate(key, (logits, (0.0,), (7.0,)))</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        print(trace.render_html())</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        ```</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">inner_combinator_closure</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="o">*</span><span class="n">gen_fns</span><span class="p">)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mixture_model</span><span class="p">(</span><span class="n">mixture_logits</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">mix_idx</span> <span class="o">=</span> <span class="n">categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">mixture_logits</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;mixture_component&quot;</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">inner_combinator_closure</span><span class="p">(</span><span class="n">mix_idx</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">@</span> <span class="s2">&quot;component_sample&quot;</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">return</span> <span class="n">v</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">return</span> <span class="n">gen</span><span class="p">(</span><span class="n">mixture_model</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 29, 2025 12:56:58 UTC">May 29, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 29, 2025 12:56:58 UTC">May 29, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="generative_functions.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Generative functions">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Generative functions
              </div>
            </div>
          </a>
        
        
          
          <a href="inference.html" class="md-footer__link md-footer__link--next" aria-label="Next: Inference">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Inference
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 MIT Probabilistic Computing Project
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["optimize", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "navigation.footer", "navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.path", "navigation.prune", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../assets/_markdown_exec_pyodide.js"></script>
      
        <script src="../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>